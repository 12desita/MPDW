---
title: "Untitled"
author: "Desita Putri Kinanthi"
date: "2025-09-02"
output: html_document
---

# Library

```{r}
library(lmtest) 
library(orcutt) 
library(HoRM)  
library(readr)
```

# Import Data

```{r}
data.ipm <- read_csv("~/Downloads/bps-od_15042_indeks_pmbngnn_manusia__prov_di_indonesia_data.csv")
data.ipm
```

# Eksplorasi Awal

```{r}
ipm.ts <-(data.ipm$IPM)
ts.plot(ipm.ts, xlab="Time Period ", ylab="IPM", 
        main = "Time Series Plot")
points(ipm.ts)
```

berdasarkan plot yang dihasilkan, terlihat ada kenaikan drastis pada periode ke-4, kemudian akan kita potong datanya dimulai dari periode ke-4 agar model yang dihasilkan lebih baik.

```{r}
data.ipm <- data.ipm[4:15,]
```

# Model Awal

asumsikan sisaan data yang digunakan menyebar normal dan homogen

```{r}
model.awal <- lm(IPM ~ Tahun, data = data.ipm)
summary(model.awal)
```

**Observasi Awal:**

Lihat! **Nilai Adjusted R-squared sangat tinggi (0.9733)** dan koefisien Tahun **sangat signifikan (p-value \< 0.001)**. Patut dicurigai adanya autokorelasi pada data ini

# Diagnosis

```{r}
# Ambil sisaan dari model
sisaan_awal <- residuals(model.awal)

# Plot sisaan terhadap waktu
plot(data.ipm$Tahun, sisaan_awal, type="o", pch=20, col="red",
     main="Plot Sisaan vs Waktu", xlab="Tahun", ylab="Sisaan")
abline(h=0, lty=2) # Garis referensi di y=0
```

**Kecurigaan:**

Plot di atas menunjukkan pola yang **tidak acak**. Perhatikan bagaimana sisaan cenderung berkelompok: titik pertama di bawah nol, lalu naik ke atas nol, dan turun lagi. Ini adalah gejala visual yang kuat dari autokorelasi positif. Sisaan positif cenderung diikuti sisaan positif, dan sebaliknya.

**Uji Formal Durbin Watson**

-   **H0 (Hipotesis Nol)**: Tidak ada autokorelasi. Sisaan saling bebas.

-   **H1 (Hipotesis Alternatif)**: Ada autokorelasi.

```{r}
dwtest(model.awal)
```

**Hasil Investigasi:**

-   P-value yang dihasilkan **sangat kecil (0.0161)**, yaitu di bawah tingkat signifikansi 0.05.

-   Kesimpulan: Kita **menolak H0**. Bukti sudah kuat. Model kita **terbukti menderita autokorelasi**.

# Metode 1: Cochrane-Orcutt

```{r}
model.co <- cochrane.orcutt(model.awal)
summary(model.co)

# rho paling optimum
rho <- model.co$rho
cat("\nRho optimum:", rho)
```

-   Nilai **rho** yang diestimasi bernilai 0,548. Ini adalah "dosis" yang digunakan untuk memperbaiki model.

-    Statistik **Durbin-Watson baru** nilainya sekarang jauh lebih dekat ke 2, dan p-value-nya (\> 0.05) menunjukkan bahwa **autokorelasi sudah berhasil diatasi**.

-   Perhatikan koefisien `(Intercept)` dan `Tahun` yang baru. Ini adalah estimasi yang lebih valid.

```{r}
ipm.trans <- data.ipm$IPM[-1] - data.ipm$IPM[-12]*rho

tahun.trans <- data.ipm$Tahun[-1] - data.ipm$Tahun[-12]*rho
model_co_manual <- lm(ipm.trans~tahun.trans)

b0_co_manual <- coef(model_co_manual)[1]/(1-rho)
b1_co_manual <- coef(model_co_manual)[2]
cat("Koefisien manual Cochrane-Orcutt:\n")
cat("b0:", b0_co_manual, "\n")
cat("b1:", b1_co_manual, "\n")
```

Hasil koefisien perhitungan manual juga menghasilkan nilai yang serupa

# Metode 2: Hildreth-Lu 

```{r}
#Penanganan Autokorelasi Hildreth lu
# Hildreth-Lu
hildreth.lu.func<- function(r, model){
  x <- model.matrix(model)[,-1]
  y <- model.response(model.frame(model))
  n <- length(y)
  t <- 2:n
  y <- y[t]-r*y[t-1]
  x <- x[t]-r*x[t-1]
  
  return(lm(y~x))
}

#Pencariab rho yang meminimumkan SSE
r <- c(seq(0.1,0.9, by= 0.1))
tab <- data.frame("rho" = r, "SSE" = sapply(r, function(i){deviance(hildreth.lu.func(i, model.awal))}))
round(tab, 4)
```
Pada hasil di atas terlihat ρ minimum ketika 0.5. Namun, hasil tersebut masih kurang teliti sehingga akan dicari kembali ρ yang lebih optimum dengan ketelitian yang lebih.

```{r}
#Rho optimal di sekitar 0.5
rOpt <- seq(0.4,0.6, by= 0.001)
tabOpt <- data.frame("rho" = rOpt, "SSE" = sapply(rOpt, function(i){deviance(hildreth.lu.func(i, model.awal))}))
head(tabOpt[order(tabOpt$SSE),])
```

```{r}
#Grafik SSE optimum
par(mfrow = c(1,1))
plot(tab$SSE ~ tab$rho , type = "l", xlab = "Rho", ylab = "SSE")
abline(v = tabOpt[tabOpt$SSE==min(tabOpt$SSE),"rho"], lty = 2, col="red",lwd=2)
```

```{r}
model.hl <- hildreth.lu(dt_ipm$ipm, dt_ipm$tahun, rho = 0.548)
summary(model.hl)
```
```{r}
#Transformasi Balik
cat("y = ", coef(model.hl)[1]/(1-0.548), "+", coef(model.hl)[2],"x", sep = "")
```
```{r}
#Deteksi autokorelasi
dwtest(model.hl)
```

-   Plot yang dihasilkan secara visual menunjukkan nilai ρ mana yang menjadi "juara" (memiliki SSE terendah).

-   Hasil summary memberikan model akhir yang juga sudah "sehat", dengan statistik D-W yang sudah membaik.

# Evaluasi Akhir
```{r}
# Menghitung SSE untuk setiap model secara manual
sse_awal <- sum(residuals(model.awal)^2)
sse_co <- sum(residuals(model.co)^2)
sse_hl <- sum(residuals(model.hl)^2)

# Membuat tabel perbandingan
data.frame(
  Metode = c("Model Awal (Sakit)", "Cochrane-Orcutt (Sehat)", "Hildreth-Lu (Sehat)"),
  SSE = c(sse_awal, sse_co, sse_hl),
  DW_Statistic = c(dwtest(model.awal)$statistic, model.co$DW[3], dwtest(model.hl)$statistic)
)
```

**Kesimpulan Investigasi:**

-   Metode Hildreth-Lu berhasil menurunkan SSE model, artinya model yang baru lebih akurat. Sedangkan metode Cochrane-Orcutt justru meningkatkan SSE.

-   Namun keduanya berhasil menghilangkan autokorelasi, yang ditunjukkan oleh statistik D-W yang mendekati 2.

-   Model akhir yang seharusnya kita gunakan adalah model yang telah ditangani dengan metode Hildreth-Lu, karena estimasi koefisien dan uji signifikansinya sekarang jauh lebih dapat dipercaya.

