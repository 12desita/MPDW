# Library

```{r}
library("forecast")
library("graphics")
library("TTR")
library("TSA")
library(rio)
library(readxl)
library(dplyr)
library(ggplot2)
```

# Import Data

```{r}
data.1 <- read_excel("~/Downloads/Kel2_Data fix Proyek_VPdef.xls", 
    sheet = "500", col_types = c("date", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric", "numeric", 
        "numeric", "numeric"))
```

setelah data berhasi diimpor, kita pilih kolom dan baris yang akan digunakan

```{r}
data.1 <- data.1[201:300,c("date", "VPdef")]
```

# Eksplorasi Data

```{r}
str(data.1)
dim(data.1)
```

```{r}
colSums(is.na(data.1))
```

```{r}
sum(duplicated(data.1))
```

struktur data sudah sesuai dan tidak ditemukan adanya missing value ataupun data ganda. kemudian kita ubah agar terbaca sebagai data deret waktu

```{r}
data.1.ts <- ts(data.1$VPdef)
```

```{r}
summary(data.1.ts)
```

```{r}
ts.plot(data.1.ts, xlab="Time Period ", ylab="VPdef", 
        main = "Time Series Plot")
points(data.1.ts)
```

berdasarkan plot yang terbentuk ada kenaikan tajam hingga periode ke-20, lalu menurun secara perlahan. pada periode ke-60 cenderung stabil. ini menunjukkan adanya fluktuasi jangka pendek dan tren jangka panjang. Perlu dilihat menggunakan data keseluruhan agar lebih mudah melihat pola yang terbentuk.

# Pembagian Data

data dibagi menjadi 80% data latih, dan 20% data uji

```{r}
train <- data.1[1:80,]
test <- data.1[81:100,]
train.ts <- ts(train$VPdef)
test.ts <- ts(test$VPdef)
```

```{r}
plot(data.1.ts, col="red",main="Plot semua data")
points(data.1.ts)
```

```{r}
#eksplorasi data latih
plot(train.ts, col="blue",main="Plot data latih")
points(train.ts)
```

```{r}
plot(test.ts, col="blue",main="Plot data uji")
points(test.ts)
```

# SMA

pada kali ini saya menggunakan m=2 hasil dari mencoba-coba berbagai nilai m, yang berarti data pada periode tertentu kira-kira dipengaruhi oleh 2 periode data sebelumnya.

```{r}
data.sma<-SMA(train.ts, n=2)
data.sma
```

```{r}
data.ramal<-c(NA,data.sma)
data.ramal #forecast 1 periode ke depan
```

Selanjutnya akan dilakukan peramalan sejumlah data uji yaitu 20 periode. Pada metode SMA, hasil peramalan 20 periode ke depan akan bernilai sama dengan hasil peramalan 1 periode kedepan. Dalam hal ini akan dilakukan pengguabungan data aktual train, data hasil pemulusan dan data hasil ramalan 20 periode kedepan.

```{r}
data.gab<-cbind(aktual=c(train.ts,rep(NA,20)),pemulusan=c(data.sma,rep(NA,20)),ramalan=c(data.ramal,rep(data.ramal[length(data.ramal)],19)))
data.gab #forecast 20 periode ke depan
```

```{r}
ts.plot(data.1.ts, xlab="Time Period ", ylab="VPdef", main= "SMA N=2 Data VPdef")
points(data.1.ts)
lines(data.gab[,2],col="green",lwd=2)
lines(data.gab[,3],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.5)
```

```{r}
#Menghitung nilai keakuratan data latih
error_train.sma = train.ts-data.ramal[1:length(train.ts)]
SSE_train.sma = sum(error_train.sma[3:length(train.ts)]^2)
MSE_train.sma = mean(error_train.sma[3:length(train.ts)]^2)
MAPE_train.sma = mean(abs((error_train.sma[3:length(train.ts)]/train.ts[3:length(train.ts)])*100))

akurasi_train.sma <- matrix(c(SSE_train.sma, MSE_train.sma, MAPE_train.sma))
row.names(akurasi_train.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.sma) <- c("Akurasi m = 2")
akurasi_train.sma
```

Dalam hal ini nilai MAPE data latih pada metode pemulusan SMA adalah 7.33%, nilai ini dapat dikategorikan sebagai nilai akurasi yang sangat baik. Selanjutnya dilakukan perhitungan nilai MAPE data uji pada metde pemulusan SMA.

```{r}
#Menghitung nilai keakuratan data uji
error_test.sma = test.ts-data.gab[81:100,3]
SSE_test.sma = sum(error_test.sma^2)
MSE_test.sma = mean(error_test.sma^2)
MAPE_test.sma = mean(abs((error_test.sma/test.ts*100)))

akurasi_test.sma <- matrix(c(SSE_test.sma, MSE_test.sma, MAPE_test.sma))
row.names(akurasi_test.sma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.sma) <- c("Akurasi m = 2")
akurasi_test.sma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang kurang dari 10% sehingga nilai akurasi ini dapat dikategorikan sebagai sangat baik.

# DMA

Selanjutnya akan kita coba pemulusan menggunakan metode DMA

```{r}
dma <- SMA(data.sma, n = 4)
At <- 2*data.sma - dma
Bt <- 2/(4-1)*(data.sma - dma)
data.dma<- At+Bt
data.ramal2<- c(NA, data.dma)

t = 1:20
f = c()

for (i in t) {
  f[i] = At[length(At)] + Bt[length(Bt)]*(i)
}

data.gab2 <- cbind(aktual = c(train.ts,rep(NA,20)), pemulusan1 = c(data.sma,rep(NA,20)),pemulusan2 = c(data.dma, rep(NA,20)),At = c(At, rep(NA,20)), Bt = c(Bt,rep(NA,20)),ramalan = c(data.ramal2, f[-1]))
data.gab2
```

```{r}
ts.plot(data.1.ts, xlab="Time Period ", ylab="VPdef", main= "DMA N=4 Data VPdef")
points(data.1.ts)
lines(data.gab2[,3],col="green",lwd=2)
lines(data.gab2[,6],col="red",lwd=2)
legend("topleft",c("data aktual","data pemulusan","data peramalan"), lty=8, col=c("black","green","red"), cex=0.8)
```

```{r}
#Menghitung nilai keakuratan data latih
error_train.dma = train.ts-data.ramal2[1:length(train.ts)]
SSE_train.dma = sum(error_train.dma[8:length(train.ts)]^2)
MSE_train.dma = mean(error_train.dma[8:length(train.ts)]^2)
MAPE_train.dma = mean(abs((error_train.dma[8:length(train.ts)]/train.ts[8:length(train.ts)])*100))

akurasi_train.dma <- matrix(c(SSE_train.dma, MSE_train.dma, MAPE_train.dma))
row.names(akurasi_train.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_train.dma) <- c("Akurasi m = 4")
akurasi_train.dma
```

Perhitungan akurasi pada data latih menggunakan nilai MAPE menghasilkan nilai MAPE yang kurang dari 10% sehingga dikategorikan sangat baik. Selanjutnya, perhitungan nilai akurasi dilakukan pada data uji.

```{r}
#Menghitung nilai keakuratan data uji
error_test.dma = test.ts-data.gab2[81:100,6]
SSE_test.dma = sum(error_test.dma^2)
MSE_test.dma = mean(error_test.dma^2)
MAPE_test.dma = mean(abs((error_test.dma/test.ts*100)))

akurasi_test.dma <- matrix(c(SSE_test.dma, MSE_test.dma, MAPE_test.dma))
row.names(akurasi_test.dma)<- c("SSE", "MSE", "MAPE")
colnames(akurasi_test.dma) <- c("Akurasi m = 4")
akurasi_test.dma
```

Perhitungan akurasi menggunakan data latih menghasilkan nilai MAPE yang lebih dari 10% sehingga nilai akurasi ini dapat dikategorikan sebagai cukup baik. Sehingga dapat dikatakan bahwa metode SMA memiliki akurasi yang lebih baik dibanding metoe DMA. Selanjutnya akan dicoba metode pemulusan SES

# SES

```{r}
ses.1 <- ses(train.ts, h = 20, alpha = 0.2)
plot(ses.1)
```

```{r}
ses.2<- ses(train.ts, h = 20, alpha = 0.7)
plot(ses.2)
```

```{r}
autoplot(ses.1) +
  autolayer(fitted(ses.1), series="Fitted") +
  ylab("VPdef") + xlab("Periode")
```

```{r}
ses.opt <- ses(train.ts, h = 20, alpha = NULL)
plot(ses.opt)
```

```{r}
accuracy(ses.1,test$VPdef)
accuracy(ses.2,test$VPdef)
accuracy(ses.opt,test$VPdef)
```

Pada metode SES menunjukkan MAPE yang lebih baik lagii dibanding metode SMA

# Kesimpulan

Metode SMA menunjukkan MAPE yang lebih baik daripada metode DMA, baik pada data latih maupun data uji. Namun, metode SES juga menunjukkan akurasi yang lebih baik. Maka pada data ini metode pemulusan yang baik digunakan adalah Single Exponential Smoothing, sejalan dengan hasil eksplorasi awal yang menunjukkan adanya tren jangka panjang.
